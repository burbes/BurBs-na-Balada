Ext.define("_Base.App",{extend:"Ext.util.Observable",constructor:function(n){this.addEvents({load:!0,edit:!0,"new":!0,beforeremove:!0,afterremove:!0,beforesave:!0,aftersave:!0,storeload:!0,beforecancel:!0,aftercancel:!0}),n.listeners&&(this.listeners=n.listeners),Ext.apply(this,n);Ext.onReady(this._initBase,this);return this},initComponent:function(){return this.callParent(arguments)},_menu:function(){Ext.select(".submenu").hover(function(){var n=Ext.get(this.id).addCls("mark").child("ul").show().select(".subPai");n.setStyle("background","#456690"),n.setStyle("color","#0c356b")},function(){var n=Ext.get(this.id).removeCls("mark").child("ul").hide().select(".subPai");n.setStyle("background","transparent"),n.setStyle("color","#ffffff")})},_toolTip:function(){Ext.tip.QuickTipManager.init(),Ext.apply(Ext.tip.QuickTipManager.getQuickTip(),{showDelay:1,trackMouse:!0})},loading:{show:function(n){Ext.MessageBox.wait(n?n:"Aguarde carregando..")},close:function(){Ext.MessageBox.hide()}},get:function(n){return Ext.getCmp(n)||Ext.get(n)},getInForm:function(n){return this._form.getForm().getFields().get(n)},getInChild:function(n,t){return t!=undefined?this._tab.items.items[t]._form.getForm().getFields().get(n):this._tab.activeTab._form.getForm().getFields().get(n)},baseUrl:window._baseUrl,permissoes:window._permissoes,sessao:window._sessao,_disableRemove:!1,_disableEdit:!1,_primaryKey:null,_className:null,_hasFilter:!1,_autoLoad:!0,_autoFilter:!0,_btnAdiciona:!0,_child:!1,_base:!0,_baseBuilder:!0,_buttons:[],_searchItems:[],_gridColumns:[],_formItems:[],_childApp:[],_search:{},_store:{},_grid:{},_form:{},_tab:{},_btn:{},_msgCodBase:{1:"Cadastrado",2:"Alterado",3:"Removido",4:"FKError",5:"RegistroExistente",6:"RegistroAtivo"},_msgCod:{},_initApp:Ext.emptyFn,_setSearchFocus:Ext.emptyFn,_setFormFocus:Ext.emptyFn,ALERT:function(n,t,i){Ext.Msg.alert(t?t:"",n,i)},SETDATE:function(n,t){Ext.Ajax.request({url:Ext.String.format("{0}{1}",this.baseUrl,"Util/GetDate"),method:"POST",success:function(i){var u=Ext.decode(i.responseText),f;u.success&&u.Data&&u.Data.date&&(n=this.get(n),f=Ext.Date.parseFunctions.MS(u.Data.date),n&&n.setValue&&f&&(n.setValue(f),t!=!1&&n.setDisabled(!0)))},scope:this})},SETTIME:function(n){Ext.Ajax.request({url:Ext.String.format("{0}{1}",this.baseUrl,"Util/GetTime"),method:"POST",success:function(t){var r=Ext.decode(t.responseText);r.success&&r.Data&&r.Data.time&&(n=this.get(n),n&&n.setValue&&n.setValue(r.Data.time))},scope:this})},SETTIMERESERVA:function(n){Ext.Ajax.request({url:Ext.String.format("{0}{1}",this.baseUrl,"Util/GetTimeReserva"),method:"POST",success:function(t){var r=Ext.decode(t.responseText);r.success&&r.Data&&r.Data.time&&(n=this.get(n),n&&n.setValue&&n.setValue(r.Data.time))},scope:this})},_buildComboEmpreendimento:function(n){var r="div-combo-empreendimento",i,t;if(!Ext.get(r))return Ext.isFunction(n)&&n(),!1;i=function(){Ext.Ajax.request({url:Ext.String.format("{0}{1}",this.baseUrl,"Login/MudaEmpreendimento"),method:"POST",params:{id_incorporador_grupo_item:this._comboEmpreendimento.getValue()},success:function(n){var i=Ext.decode(n.responseText);i.success&&(window.location.href=Ext.String.format("{0}{1}",this.baseUrl,"Dashboard"))},scope:this})},t=function(){Ext.Msg.show({title:"Mudar Vis\u00e3o de Empreendimento",msg:"Confirma a mudan\u00e7a do Empreendimento?<br/>Voc\u00ea perder\u00e1 qualquer informa\u00e7\u00e3o n\u00e3o salva.",buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,fn:function(n){n=="yes"?(this.loading.show(),Ext.bind(i,this)()):this._comboEmpreendimento.setValue(window._id_incorporador_grupo_item)},scope:this})},this._comboEmpreendimento=Ext.create("Ext.form.ComboBox",{width:300,renderTo:r,emptyText:"Selecione um Empreendimento",editable:!1,forceSelection:!0,store:this._createStore("Login",[{dataIndex:"nome_empreendimento",dataType:"string"},{dataIndex:"id_empreendimento",dataType:"int"},{dataIndex:"descricao_incorporador_grupo",dataType:"string"},{dataIndex:"id_incorporador_grupo",dataType:"int"},{dataIndex:"id_incorporador_grupo_item",dataType:"int"}],"ListaEmpreendimento"),queryMode:"local",displayField:"nome_empreendimento",valueField:"id_incorporador_grupo_item",listConfig:Ext.Templates.ComboIncorporador,listeners:{select:Ext.bind(t,this)}}),this._comboEmpreendimento.store.load({callback:function(){this.setValue(window._id_incorporador_grupo_item),Ext.isFunction(n)&&n()},scope:this._comboEmpreendimento})},_initBase:function(){this._menu(),this._toolTip(),this._initApp();var n=Ext.emptyFn;n=this._base===!0?function(){this._baseBuilder===!0&&(this._buttonBuilder(),this._searchBuilder(),this._formBuilder(),this._gridBuilder(),this._childBuilder(),this._childLayout(),this._setVisible(!0),this._filterParams=Ext.encode([]),this._fnRecursive(this._form.getForm().getFields().items,function(n){this._form._fields[n.id]=n},this)),this.fireEvent("load",this),this._searchFocus&&(this._setSearchFocus=function(){var n=this.get(this._searchFocus);n&&n.focus()},this._setSearchFocus()),this._formFocus&&(this._setFormFocus=function(){var n=this.get(this._formFocus);n&&n.focus()},this._setFormFocus()),this.maskLoading.hide()}:function(){this.maskLoading.hide(),this.fireEvent("load",this)},this._buildComboEmpreendimento(Ext.bind(n,this))},maskLoading:{show:function(){Ext.select("#loading").setStyle("display","block"),Ext.select("#loading").fadeIn({easing:"easeOut",opacity:1,duration:500})},hide:function(){Ext.Function.defer(function(){Ext.select("#loading").fadeOut({easing:"easeOut",opacity:0,duration:500,callback:function(){Ext.select("#loading").setStyle("display","none")}})},500)}},_baseAction:{_list:"Lista",_manager:"InsereAltera",_remove:"Remove"},_getActions:function(n,t){return{_list:Ext.String.format("{0}{1}/{2}",n,t,this._baseAction._list),_manager:Ext.String.format("{0}{1}/{2}",n,t,this._baseAction._manager),_remove:Ext.String.format("{0}{1}/{2}",n,t,this._baseAction._remove),_cep:Ext.String.format("{0}CEP/Get",n)}},_getParams:function(n){return{_className:n._className,_primaryKey:n._primaryKey,_foreignKey:n._foreignKey}},_childAdd:function(n){this._childApp.push(n)},_fnRecursive:function(n,t,i){for(var u=function(n,i){var f,r;if(n.items&&n.items.length)u(n.items,i);else for(Ext.isArray(n)||(n=[n]),f=0;f<n.length;f++)(r=n[f],r!=undefined&&r!=null)&&(r.items&&r.items.length&&r.xtype&&r.xtype!="grid"?u(r.items,i):Ext.bind(t,i,[r])())},r=0;r<n.length;r++)u(n[r],i)},_columnsBuilder:function(n){var t={name:n.dataIndex,type:n.dataType};return t.type?t.type==="datetime"||t.type==="date"?(t.type="date",t.dateFormat=n.dateFormat?n.dateFormat:"d/m/Y",t.convert=function(n){return Ext.isDate(n)?Ext.util.Format.dateRenderer(this.dateFormat)(n):Ext.util.Format.dateRenderer(this.dateFormat)(Ext.Date.parseFunctions.MS(n))},t.renderer=function(n,t,i,r,u){return Ext.isDate(n)?Ext.util.Format.dateRenderer(this.columns[u].dateFormat)(n):n}):t.type==="decimal"?t.type="float":t.type==="bool"&&(t.type="boolean"):t.type="string",t},_createStore:function(n,t,i,r,u){for(var e,o,f=0;f<t.length;f++)t[f]=Ext.applyIf(t[f],this._columnsBuilder(t[f]));return e=Ext.String.format("{0}{1}DataModel",n,(+new Date).toString()),o=Ext.define(e,{extend:"Ext.data.Model",fields:t,proxy:{type:"ajax",url:Ext.String.format("{0}{1}/{2}",this.baseUrl,n,i?i:this._baseAction._list)}}),Ext.create("Ext.data.Store",{model:e,autoLoad:r!=undefined?r:!1,groupField:u!=undefined?u:undefined})},_createStoreDynamic:function(n,t,i){for(var u,f,r=0;r<t.length;r++)t[r]=Ext.applyIf(t[r],this._columnsBuilder(t[r]));return u=Ext.String.format("{0}{1}DataModel",n,(+new Date).toString()),f=Ext.define(u,{extend:"Ext.data.Model",fields:t,proxy:{type:"ajax",url:Ext.String.format("{0}{1}/{2}",this.baseUrl,n,i?i:this._baseAction._list),reader:{type:"json",root:"root",totalProperty:"totalProperty"}}}),Ext.create("Ext.data.Store",{pageSize:10,model:u})},_getChildValues:function(n,t){var u={},i,r;if(n&&t&&(u[n]=t),this._childApp.length!=0)for(i=0;i<this._tab.items.items.length;i++)r=this._tab.items.items[i],u["_JSON_"+r._className]=this._getJSON(r._grid,n,t),u["_PK_"+r._className]=this._tab.items.items[i]._primaryKey,u["_FK_"+r._className]=this._tab.items.items[i]._foreignKey;return u},_getJSON:function(n,t,i){for(var u="",f,r=0;r<n.store.data.items.length;r++)f=n.store.data.items[r].data,t&&i&&(f[t]=i),u+=Ext.encode(f)+",";return u.length!=0?"["+u.substring(0,u.length-1)+"]":""},_gridColumnsBuilder:function(n,t,i){var f=[],e=undefined,o=undefined,r,u;for(t._child?(e=i._disableRemove,o=i._disableEdit):(e=t._disableRemove,o=t._disableEdit),this.permissoes.exclui_perfil_aplicacao===!1&&(e=!0),e||f.push([{xtype:"actioncolumn",align:"center",header:"Remover",width:70,items:[{tooltip:"Remover",iconCls:"iconsGrid",icon:Ext.String.format("{0}Content/img/icons/bgBtnDelete.png",this.baseUrl),handler:function(n,i,r){Ext.bind(this._fnRemove,this,[n,i,r,t])()},scope:this}]}]),o||f.push([{xtype:"actioncolumn",align:"center",header:"Editar",width:70,items:[{tooltip:"Editar",iconCls:"iconsGrid",icon:Ext.String.format("{0}Content/img/icons/bgBtnEditar.png",this.baseUrl),handler:function(n,i){Ext.bind(this._fnEdit,this,[n.store.getAt(i),t])()},scope:this}]}]),r=0;r<n.length;r++)u=n[r],Ext.apply(u,this._columnsBuilder(u)),f.push(u);return f},_buttonBuilder:function(){this._btn=Ext.create("Ext.Button",{text:"Adicionar novo elemento",renderTo:"ext-btn",handler:Ext.bind(this._fnNew,this,[!0,this]),tooltip:"Adicionar novo elemento"}),this.permissoes.insere_perfil_aplicacao===!1&&this._btn.setDisabled(!0),this._btnAdiciona===!1&&this._btn.setVisible(!1)},_gridBuilder:function(){for(var i=[],t,n=0;n<this._gridColumns.length;n++)i.push(this._columnsBuilder(this._gridColumns[n]));t=this._form._actions._list,this._classNameGrid!==undefined&&(t=this._getActions(this.baseUrl,this._classNameGrid)._list),this._store=Ext.create("Ext.data.Store",{ignoraFiltroAtivo:!0,isGrid:!0,pageSize:10,model:Ext.define(this._className+"DataModel",{extend:"Ext.data.Model",idProperty:this._primaryKey,fields:i}),proxy:{type:"ajax",url:t,extraParams:this._getParams(this),reader:{root:"root",totalProperty:"totalProperty"}}}),this._gridColumns=this._gridColumnsBuilder(this._gridColumns,this),this._paging=Ext.create("Ext.PagingToolbar",{store:this._store,displayInfo:!0,displayMsg:"Mostrando {0} de {1} - Total {2}",emptyMsg:"Nenhum registro encontrado"});this._paging.on("beforechange",function(n){n.store.proxy.extraParams._filterParams=this._filterParams},this);this._grid=Ext.create("Ext.grid.Panel",{renderTo:"ext-grid",anchor:"100%",height:282,autoScroll:!0,loadMask:!0,viewConfig:{loadMask:{msg:"Carregando..."}},enableColumnHide:!1,enableColumnMove:!1,enableColumnResize:!1,store:this._store,columns:this._gridColumns,bbar:this._paging}),this._autoLoad===!0&&this._store.load()},_handlerItems:function(n,t,i){this._fnRecursive(n,function(n){var u,f,r;n.plugins&&(n.mask=n.plugins[0].rawMask),n.mask&&(n.plugins=[new CMS.mask(n.mask,t===!0?!1:!0)],n.saveMask=n.saveMask!==undefined?n.saveMask:!1),u="",f=n.upperCase===undefined?!0:n.upperCase,f&&(u+="text-transform: uppercase;"),n.xtype&&(n.xtype.indexOf("number")!=-1||n.xtype.indexOf("currency")!=-1)&&(u+=" text-align: right;"),r={},Ext.apply(r,n.listeners),t===!0&&(i?(r.changefilter=Ext.bind(this._fnFilter,this,[i]),n.childId=n.id):r.changefilter=Ext.bind(this._fnFilter,this,[]),n.xtype=="combo"&&(n.xtype="xcombo",n.editable=!1)),Ext.apply(n,{_upperCase:f,fieldStyle:u,enforceMaxLength:n.enforceMaxLength===undefined?!0:n.enforceMaxLength,name:n.name?n.name:n.id,margins:n.margins?n.margins:"5",enableKeyEvents:!0,listeners:r})},this)},_formButtons:function(n,t){var f=n._child?"_btnSalvarChild":"_btnSalvar",u,r,i;if(this[f]=Ext.create("Ext.Button",{xtype:"button",text:"Salvar",handler:Ext.bind(this._fnSave,n,[t]),tooltip:"Salvar"}),u=n._child?"_btnCancelChild":"_btnCancel",this[u]=Ext.create("Ext.Button",{xtype:"button",text:"Cancelar",handler:Ext.bind(this._fnCancel,n,[t,!1]),tooltip:"Cancelar"}),r=[this[f],this[u]],n._child===!1)for(i=0;i<t._buttons.length;i++)r.push(t._buttons[i]);return r},_formBuilder:function(){var n={};this._handlerItems(this._formItems),this._form=Ext.create("Ext.form.FormPanel",{renderTo:"ext-form",buttonAlign:"left",border:!1,items:this._formItems,buttons:this._formButtons(this,this),_actions:this._getActions(this.baseUrl,this._className),_postParams:this._getParams(this),_fields:{},fieldDefaults:{labelAlign:"top",labelSeparator:""}})},_searchBuilder:function(){var n=[];this._autoFilter||(n=[{id:"btnFiltrar",xtype:"button",width:100,margin:"0 10 0 0",text:"Filtrar",handler:Ext.bind(this._fnFilter,this,[undefined,!0])}]),this._handlerItems(this._searchItems,!0),this._searchItems.length!=0&&(this._search=Ext.create("Ext.form.FormPanel",{renderTo:"ext-search",title:"Filtros",fieldDefaults:{padding:"5px",labelAlign:"top",labelSeparator:""},collapsible:!0,items:this._searchItems,buttons:n}))},_fnSave:function(n){var l=function(n,t,i,r,u){n._values=Ext.apply(Ext.apply({},n._postParams),i);var f=r,e=undefined;if(u===!0&&(e=f._child?f.activeTab._win.fireEvent("beforesave",f.activeTab,n._values):f.fireEvent("beforesave",f,n._values)),e===!1)return f._child&&f.activeTab._win.close(),!1;n.getForm().submit({url:n._actions._manager,params:n._values,waitMsg:"Aguarde..",waitTitle:"",_fn:function(n,i){var e;switch(i.failureType){case Ext.form.action.Action.CLIENT_INVALID:Ext.Msg.alert("Aviso","Formul\u00e1rio cont\u00e9m campos preenchidos incorretamente");break;case Ext.form.action.Action.CONNECT_FAILURE:Ext.Msg.alert("Aviso","Erro de conex\u00e3o com o servidor");break;default:var u=r,f=i.result,o=null;u._child?(e=u.activeTab._msgCodBase[f.msgCod],u.activeTab._msgCod&&u.activeTab._msgCod[e]&&(f.msg=u.activeTab._msgCod[e]),o=u.activeTab._form.getForm().getValues(undefined,undefined,undefined,!0),u.activeTab._win.fireEvent("aftersave",u.activeTab,o)):(e=u._msgCodBase[f.msgCod],u._msgCod&&u._msgCod[e]&&(f.msg=u._msgCod[e]),o=u._form.getForm().getValues(undefined,undefined,undefined,!0),u.fireEvent("aftersave",u,o)),f.values&&f.values.pkName&&f.values.pkValue&&(o[f.values.pkName]=f.values.pkValue),f.success?Ext.Msg.alert("Sucesso",f.msg,Ext.bind(this._fnCancel,r,[t,!0,o])):Ext.Msg.alert("Erro",f.msg)}},success:function(n,i){Ext.bind(this._fn,t,[n,i])()},failure:function(n,i){Ext.bind(this._fn,t,[n,i])()}})},a=function(n){return n.getForm().isValid()?!0:(Ext.Msg.show({title:"Aviso",msg:"Existem campos inv\u00e1lidos",buttons:Ext.Msg.OK,icon:Ext.Msg.WARNING}),!1)},u,e,r,c,o,h;if(this._child){if(a(this.activeTab._form)){var f=this.activeTab._grid,i=this.activeTab._form,s=this.activeTab._win;if(i._values=i.getForm().getValues(undefined,undefined,undefined,!0),i._skipInsert=!1,u=parseInt(i._values[i._postParams._primaryKey]),e=parseInt(n.get(i._postParams._foreignKey).getValue()),s.fireEvent("beforesave",this.activeTab,i._values)===!1)return!1;r=new window[this.activeTab._className+"DataModel"](i._values);for(c in r.data)r.data[c]||delete r.data[c];for(o=0;o<f.columns.length;o++)h=f.columns[o],h.dataFormat&&(r.data[h.dataIndex]=new Ext.XTemplate(h.dataFormat).applyTemplate(r.data));Ext.isNumber(e)&&e!=0?Ext.bind(l,this,[i,n,n._getChildValues(i._postParams._foreignKey,e),n._tab,!1])():Ext.isNumber(u)&&u!=0?Ext.bind(l,this,[i,n,n._getChildValues(),n._tab,!1])():(i._record&&f.store.remove(i._record),i._skipInsert===!1&&f.store.insert(f.store.getCount(),r),s.fireEvent("aftersave",this.activeTab,this.activeTab._form.getForm().getValues(undefined,undefined,undefined,!0))!==!1&&s.isVisible()&&s.close())}}else a(this._form)&&(u=parseInt(this._form.getForm().getValues()[this._form._postParams._primaryKey]),Ext.bind(l,this,[this._form,n,Ext.isNumber(u)&&u!=0?{}:n._getChildValues(),n,!0])())},_fnCancel:function(n,t,i){var e,r,o,s;if(this._child){var f=this.activeTab,c=f._grid,h=f._form,u=f._win;if(u.fireEvent("beforecancel",f,i)===!1)return!1;if(h.getForm().reset(),u.isVisible()&&u.close(),t){if(e={},n&&n.get&&n._form&&(r=n._form.getForm().getFields().get(this.activeTab._foreignKey),r&&r.getValue&&(e[this.activeTab._foreignKey]=r.getValue()),this.activeTab._foreignKeyExtra)){o=this.activeTab._foreignKeyExtra.split(",");for(s in o)r=n._form.getForm().getFields().get(o[s]),r&&r.getValue&&(e[o[s]]=r.getValue())}c.store.load({scope:u,callback:function(){this.fireEvent("storeload",i)},params:e})}u.fireEvent("aftercancel",f,i)}else{if(this.fireEvent("beforecancel",this,i)===!1)return!1;this._form.getForm().reset(),this._setVisible(!0),t&&this._grid.store.load({scope:this,callback:function(){this.fireEvent("storeload",i)}}),this._setSearchFocus(),this.fireEvent("aftercancel",this,i)}},_fnNew:function(n,t){var r,i;if(t._child)i=t.activeTab,i._form.getForm().reset(),this._fnDisableForm(i._form,!1),i._win.show(undefined,function(){Ext.Function.defer(this._setFormFocus,500)},i),delete i._form._record,n!==!1&&(i._win.fireEvent("new",t),i._form.getForm().isValid()),this.permissoes.insere_perfil_aplicacao===!1?this._btnSalvarChild.setDisabled(!0):this._btnSalvarChild.setDisabled(!1);else{if(t._form.getForm().reset(),t._fnDisableForm(this._form,!1),t._setVisible(!1),n!==!1&&t._childLayout(),delete t._form._record,n!==!1&&(t.fireEvent("new",t),t._form.getForm().isValid()),t._childApp.length!=0)for(r=0;r<t._tab.items.items.length;r++)t._tab.items.items[r]._grid.store.removeAll();t.permissoes.insere_perfil_aplicacao===!1?t._btnSalvar.setDisabled(!0):t._btnSalvar.setDisabled(!1),t._setFormFocus()}},_setVisible:function(n){Ext.get("div-main").setStyle("display",n?"block":"none"),this._form.setVisible(!n)},_fnRemove:function(n,t,i,r){if(r._child){if(r.activeTab._win.fireEvent("beforeremove",n.store.getAt(t).data)===!1)return!1}else if(this.fireEvent("beforeremove",n.store.getAt(t).data)===!1)return!1;var u=function(n,t,i){Ext.Ajax.request({url:n,params:t,method:"POST",success:function(n){var i=this==r?this:r,f=Ext.decode(n.responseText),u,e;i._child?(u=i.activeTab._msgCodBase[f.msgCod],i.activeTab._msgCod&&i.activeTab._msgCod[u]&&(f.msg=i.activeTab._msgCod[u])):(u=i._msgCodBase[f.msgCod],i._msgCod&&i._msgCod[u]&&(f.msg=i._msgCod[u])),e=Ext.Function.createSequence(this._fnCancel,function(){this._child?this.activeTab._win.fireEvent("afterremove"):this.fireEvent("afterremove")},i),Ext.Msg.alert(f.success?"Sucesso":"Erro",f.msg,Ext.bind(e,i,[this,!0]))},failure:function(){Ext.Msg.alert("Erro","Erro de conex\u00e3o com o servidor")},scope:i})},f=function(i){var f;if(i!="yes")return!1;if(this.loading.show(),f={},r._child){var c=r.activeTab._grid,o=r.activeTab._form,h=o.getForm().getValues(),e=parseInt(h[o._postParams._primaryKey]),s=parseInt(this.get(o._postParams._foreignKey).getValue());Ext.isNumber(s)&&s!=0||Ext.isNumber(e)&&e!=0?(e=r.activeTab._form._postParams._primaryKey,f._primaryKey=e,f[e]=n.store.getAt(t).data[e],u(r.activeTab._form._actions._remove,f,this)):(n.store.remove(n.store.getAt(t)),r.activeTab._win.fireEvent("afterremove"),this.loading.close())}else f._primaryKey=this._primaryKey,f[this._primaryKey]=n.store.getAt(t).data[this._primaryKey],u(this._form._actions._remove,f,this)};Ext.Msg.show({title:"Confirma\u00e7\u00e3o de remo\u00e7\u00e3o",msg:"Deseja realmente excluir este registro?",buttons:Ext.Msg.YESNO,icon:Ext.MessageBox.QUESTION,fn:f,scope:this})},_fnDisableForm:function(n,t){this._fnRecursive(n.items.items,function(n){if(!n.disabled){var i=this.get(n.id);i&&i.setDisabled&&i.setDisabled(t)}},this)},_fnEdit:function(n,t){var s=function(n){var r=this._form.getForm().getFields().items,t;for(i=0;i<r.length;i++)t=r[i],t.isSystemEdit=!0,t.refId?t.setValue(n[t.refId]):t.setValue(n[t.id]),t.isSystemEdit=!1},i,f,u,e,o,r;if(t._child)r=t.activeTab,r._form.getForm().reset(),r._form._record=n,r._win.show(undefined,function(){Ext.Function.defer(this._setFormFocus,500)},r),Ext.bind(s,r,[n.data])(),this.permissoes.altera_perfil_aplicacao===!1&&this._fnDisableForm(r._form,!0),r._win.fireEvent("edit",n.data,this),r._form.getForm().isValid(),this.permissoes.altera_perfil_aplicacao===!1?this._btnSalvarChild.setDisabled(!0):this._btnSalvarChild.setDisabled(!1);else{if(this._fnNew(!1,t),this._form._record=n,Ext.bind(s,this,[n.data])(),this._childLayout(),this.permissoes.altera_perfil_aplicacao===!1&&this._fnDisableForm(this._form,!0),this.fireEvent("edit",n.data,this),this._form.getForm().isValid(),this._childApp.length!=0)for(i=0;i<this._tab.items.items.length;i++){if(Ext.bind(this.fnActivateTab,this._tab.items.items[i])(),f={},u=this._form.getForm().getFields().get(this._tab.items.items[i]._foreignKey),u&&u.getValue&&(f[this._tab.items.items[i]._foreignKey]=u.getValue()),this._tab.items.items[i]._foreignKeyExtra){e=this._tab.items.items[i]._foreignKeyExtra.split(",");for(o in e)u=this._form.getForm().getFields().get(e[o]),u&&u.getValue&&(f[e[o]]=u.getValue())}this._tab.items.items[i]._grid.store.load({scope:this._tab.items.items[i]._win,params:f,callback:function(){this.fireEvent("storeload")}})}this.permissoes.altera_perfil_aplicacao===!1?this._btnSalvar.setDisabled(!0):this._btnSalvar.setDisabled(!1)}},fnActivateTab:function(){if(this._label.setText("&nbsp;",!1),this._btn.setDisabled(!1),this._disabledTabNew!==!0)return!1;var n=Ext.getCmp(this._foreignKey);n&&(n=n.getValue(),isNaN(parseFloat(n))&&this._disabledTabNew===!0&&this._disabledTabNewMsg&&(this._btn.setDisabled(!0),this._label.setText(this._disabledTabNewMsg,!1)))},_childBuilder:function(){var f,n,l,a,o,r,t,s,c,i,v,u,e,p;if(this._childApp.length==0)return!1;for(this._tab=Ext.create("Ext.tab.Panel",{_child:!0,plain:!0,activeTab:0}),this._form.add(this._tab),f=0;f<this._childApp.length;f++){for(n=this._childApp[f],n._disableEdit=n._disableEdit!==undefined?n._disableEdit:!1,n._disableRemove=n._disableRemove!==undefined?n._disableRemove:!1,l=[],a=Ext.String.format("childTab_{0}",n._className),o=0;o<n._gridColumns.length;o++)l.push(this._columnsBuilder(n._gridColumns[o]));var g=this._gridColumnsBuilder(n._gridColumns,this._tab,n),b=this._getActions(this.baseUrl,n._className),y=undefined;n._searchItems&&n._searchItems.length!=0&&(this._handlerItems(n._searchItems,!0,a),n._searchItems.length!=0&&(y=Ext.create("Ext.form.FormPanel",{title:"Filtros",fieldDefaults:{padding:"5px",labelAlign:"top",labelSeparator:""},collapsible:!0,items:n._searchItems}))),r=b._list,n._classNameGrid!==undefined&&(r=this._getActions(this.baseUrl,n._classNameGrid)._list),n._urlGrid!==undefined&&(r=this.baseUrl+n._className+"/"+n._urlGrid);var w=Ext.create("Ext.data.Store",{ignoraFiltroAtivo:!0,pageSize:10,model:Ext.define(n._className+"DataModel",{extend:"Ext.data.Model",idProperty:n._primaryKey,fields:l}),proxy:{type:"ajax",url:r,extraParams:this._getParams(n),reader:{root:"root",totalProperty:"totalProperty"}}}),d=Ext.create("Ext.grid.Panel",{anchor:"100%",height:256,autoScroll:!0,loadMask:!0,viewConfig:{loadMask:{msg:"Carregando..."}},enableColumnHide:!1,enableColumnMove:!1,enableColumnResize:!1,store:w,columns:g}),k=Ext.create("Ext.form.Label",{html:"&nbsp;",style:"padding: 5px;"}),h=Ext.create("Ext.Button",{text:"Adicionar novo elemento",handler:Ext.bind(this._fnNew,this,[!0,this._tab]),tooltip:"Adicionar novo elemento"});this.permissoes.insere_perfil_aplicacao===!1&&h.setDisabled(!0),t=[],n._extraItems&&(this._handlerItems(n._extraItems),t.push(n._extraItems)),s={xtype:"container",items:[k,h]},y?(t.push(y),s.style="text-align: right; margin-bottom: 5px; margin-top: 5px;"):s.style="text-align: right; margin-bottom: 5px;",n._removeAdd!==!0&&t.push(s),t.push(d),c=Ext.create("Ext.form.FormPanel",{border:!1,buttonAlign:"left",padding:"5px",fieldDefaults:{padding:"5px",labelAlign:"top",labelSeparator:""},items:t}),this._handlerItems(n._formItems),i=Ext.create("Ext.form.FormPanel",{border:!0,buttonAlign:"left",items:n._formItems,_actions:b,_postParams:this._getParams(n),_fields:{},buttons:this._formButtons(this._tab,this),fieldDefaults:{padding:"5px",labelAlign:"top",labelSeparator:""}}),this._fnRecursive(i.getForm().getFields().items,function(n){n.childId=n.id,i._fields[n.childId]=n}),v={},n.listeners&&(v=n.listeners),u=Ext.create("widget.window",{width:n._width?n._width:400,height:n._height?n._height:undefined,modal:!0,closable:!1,closeAction:"hide",title:n._tabName,items:[i],listeners:v}),u.addEvents({winshow:!0,edit:!0,"new":!0,beforeremove:!0,afterremove:!0,beforesave:!0,aftersave:!0,storeload:!0,beforecancel:!0,aftercancel:!0});u.on("show",function(){this.fireEvent("winshow",this)});n._setFormFocus=n._formFocus?Ext.bind(function(){var n=App.get(this._formFocus);n&&n.focus()},n):Ext.emptyFn,e={},Ext.apply(e,n.listeners),p=this,e.activate=function(){Ext.bind(p.fnActivateTab,this)()},this._tab.add({id:a,title:n._tabName,items:[c],_searchItems:n._searchItems,_primaryKey:n._primaryKey,_foreignKey:n._foreignKey,_className:n._className,_foreignKeyExtra:n._foreignKeyExtra,_store:w,_panel:c,_label:k,_form:i,_grid:d,_btn:h,_win:u,_msgCodBase:this._msgCodBase,_msgCod:n._msgCod!==undefined?n._msgCod:{},_formFocus:n._formFocus,_setFormFocus:n._setFormFocus,_disableEdit:n._disableEdit,_disableRemove:n._disableRemove,_disabledTabNew:n._disabledTabNew!==undefined?n._disabledTabNew:!1,_disabledTabNewMsg:n._disabledTabNewMsg?n._disabledTabNewMsg:"",listeners:e})}},_childLayout:function(){if(this._childApp.length==0)return!1;for(var n=0;n<this._tab.items.items.length;n++)this._tab.setActiveTab(n),this._tab.items.items[n].doLayout();this._tab.setActiveTab(0)},_fnFilter:function(n,t){var r=n?this.get(n)._grid.store:this._paging,e=n?this.get(n)._grid:this._grid,f=n?this.get(n)._searchItems:this._searchItems,u=[],i;if(this._fnRecursive(f,function(n){var t=this.get(n.id),i=undefined;if(t&&n.refId&&t.getValue){if(t.isSubmit=!0,t.isSearch=!0,i=t.getValue(!0)){if(t.plugins&&t.plugins[0].viewMask==i)return;u.push({_ref:n.refId,_value:i.toString().toUpperCase()})}t.isSubmit=!1,t.isSearch=!1}},this),t&&(this._hasFilter=!0),this._filterParams=Ext.encode(u),u.length==0)return this._hasFilter===!0&&(n?(i={},i[this.get(n)._foreignKey]=this.get(this.get(n)._foreignKey).getValue(),r.load({params:i})):(this._autoFilter||t)&&r.doRefresh()),this._hasFilter=!1,!1;this._hasFilter=!0,n?(i={},i[this.get(n)._foreignKey]=this.get(this.get(n)._foreignKey).getValue(),i._filterParams=this._filterParams,r.load({params:i})):(this._autoFilter||t)&&r.moveFirst()},GridBuider:function(n,t,i,r,u,f){for(var c=[],l,e,s,h,o=0;o<t.length;o++)c.push(this._columnsBuilder(t[o]));l=this._getActions(this.baseUrl,i)._list,e=Ext.create("Ext.data.Store",{ignoraFiltroAtivo:!0,isGrid:!0,pageSize:10,model:Ext.define(i+"DataModel",{extend:"Ext.data.Model",fields:c}),proxy:{type:"ajax",url:l,reader:{root:"root",totalProperty:"totalProperty"}}}),t=this._gridColumnsBuilder(t,{_disableRemove:r,_disableEdit:u}),s=Ext.create("Ext.PagingToolbar",{store:e,displayInfo:!0,displayMsg:"Mostrando {0} de {1} - Total {2}",emptyMsg:"Nenhum registro encontrado"});s.on("beforechange",function(n){n.store.proxy.extraParams._filterParams=this._filterParams},this);return h={xtype:"grid",id:n,anchor:"100%",height:282,loadMask:!0,viewConfig:{loadMask:{msg:"Carregando..."}},enableColumnHide:!1,enableColumnMove:!1,enableColumnResize:!1,store:e,columns:t,bbar:s},f===!0&&e.load(),h}})