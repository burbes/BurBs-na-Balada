Ext.define("Ext.ux.form.CurrencyField",{extend:"Ext.form.field.Text",alias:"widget.currencyfield",enableKeyEvents:!0,skipDefault:!1,prefix:"",centsSeparator:",",thousandsSeparator:".",limit:!1,clearPrefix:!1,allowNegative:!1,is_number:/[0-9]/,to_numbers:function(n){for(var t="",i=0;i<n.length;i++)char_=n.charAt(i),t.length==0&&char_==0&&(char_=!1),char_&&char_.match(this.is_number)&&(t=this.limit&&t.length<this.limit?t+char_:t+char_);return t},fill_with_zeroes:function(n){while(n.length<this.centsLimit+1)n="0"+n;return n},price_format:function(n,t,i){var e;t!==!0&&(n=parseFloat(n).toString()),i===!0&&this.setPercent(!0);var r=this.fill_with_zeroes(this.to_numbers(n)),u="",s=0,o=r.substr(r.length-this.centsLimit,this.centsLimit),f=r.substr(0,r.length-this.centsLimit);if(r=f+this.centsSeparator+o,this.thousandsSeparator){for(e=f.length;e>0;e--)char_=f.substr(e-1,1),s++,s%3==0&&(char_=this.thousandsSeparator+char_),u=char_+u;u.substr(0,1)==this.thousandsSeparator&&(u=u.substring(1,u.length)),r=u+this.centsSeparator+o}return this.allowNegative&&n.indexOf("-")!=-1&&(f!=0||o!=0)&&(r="-"+r),this.prefix&&(r=this.prefix+r),i===!0&&this.setMoney(!0),r},key_check:function(n){var t=n.keyCode?n.keyCode:n.which,f=String.fromCharCode(t),i=!1,r=this.getValue(),u=this.price_format(r+f,!0);(t>=48&&t<=57||t>=96&&t<=105)&&(i=!0),(t==8||t==9||t==13||t==46||t==37||t==39)&&(i=!0),this.allowNegative&&(t==189||t==109)&&(i=!0),i||(n.preventDefault(),n.stopPropagation(),r!=u&&this.setValue(u))},price_it:function(){var t=this.getValue(),n=this.price_format(this.getValue(),!0);t!=n&&this.setValue(n)},add_prefix:function(){this.setValue(this.prefix+this.getValue())},clear_prefix:function(n){if(Ext.String.trim(this.prefix)!=""&&this.clearPrefix){var t=this.getValue().split(this.prefix);if(n!==!0)this.setValue(t[1]);else return t[1]}return this.value?this.value:""},initComponent:function(){this.skipDefault===!1&&(this.isPercent===!0?this.setPercent(!0):this.setMoney(!0));this.on("blur",function(){this.clear_prefix()},this);this.on("focus",function(){this.add_prefix()},this);return this.callParent(arguments)},onKeyDown:function(n){this.fireEvent("keydown",this,n),this.key_check(n)},onKeyUp:function(n){this.fireEvent("keyup",this,n),this.price_it(n)},setValue:function(n,t){var r,i;return n&&(n=n.toString(),t!==!0&&(r=this.price_format(n,!0),r!=n&&(n=r))),i=this,i.setRawValue(i.valueToRaw(n)),i.mixins.field.setValue.call(i,n)},processRawValue:function(n){if(this.isSubmit===!0){n=this.clear_prefix(!0).toString();var t=this.price_format(n,!0);for(t!=n&&(n=t);n.indexOf(this.thousandsSeparator)!=-1;)n=n.replace(this.thousandsSeparator,"");return n}return n},getPercent:function(n){return n?n.toString()+"0":this.getValue()+"0"},setPercent:function(n){this.skipDefault===!1&&(this.centsLimit=3,this.maxLength=7),this.isPercent||this.setValue(this.getPercent(),!0),this.isPercent=!0,n!==!0&&this.reset()},getMoney:function(n){var t=null;return t=n?n.toString():this.getValue(),t=t.substring(0,t.length-1).replace(",",""),t=t.substring(0,t.length-this.centsLimit)+","+t.substring(t.length-this.centsLimit)},setMoney:function(n){this.skipDefault===!1&&(this.centsLimit=2,this.maxLength=13),this.isPercent&&this.setValue(this.getMoney(),!0),this.isPercent=!1,n!==!0&&this.reset()},getSubmitData:function(){var n=this,t=null;return n.submitValue&&!n.isFileUpload()&&(t={},t[n.getName()]=""+n.getValue()),t},getModelData:function(){var t=this,n=null;return t.isFileUpload()||(n={},n[t.getName()]=t.getValue()),n}})